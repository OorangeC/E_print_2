# åç«¯äº¤æ¥æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
3. [æ•°æ®åº“ç»“æ„](#æ•°æ®åº“ç»“æ„)
4. [DTOå±‚è½¬æ¢é€»è¾‘](#dtoå±‚è½¬æ¢é€»è¾‘)
5. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
6. [çŠ¶æ€æšä¸¾æ˜ å°„](#çŠ¶æ€æšä¸¾æ˜ å°„)
7. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
8. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè®¢å•ç®¡ç†ç³»ç»Ÿï¼ˆE-Printï¼‰çš„åç«¯æœåŠ¡ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š
- **è®¢å•ç®¡ç†**ï¼šè®¢å•çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€çŠ¶æ€ç®¡ç†
- **å·¥ç¨‹å•ç®¡ç†**ï¼šå·¥ç¨‹å•çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€çŠ¶æ€ç®¡ç†
- **æ–‡ä»¶ä¸Šä¼ **ï¼šæ”¯æŒè®¢å•å’Œå·¥ç¨‹å•çš„é™„ä»¶ä¸Šä¼ 
- **å®¡è®¡æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰å…³é”®æ“ä½œçš„å®¡è®¡æ—¥å¿—

åç«¯é‡‡ç”¨ **Express.js + TypeScript** æ„å»ºï¼Œä½¿ç”¨ **Prisma ORM** ç®¡ç†æ•°æ®åº“ï¼Œæ”¯æŒ **MySQL**ï¼ˆè®¢å•/å·¥ç¨‹å•ï¼‰å’Œ **MongoDB**ï¼ˆå®¡è®¡æ—¥å¿—ï¼‰åŒæ•°æ®åº“æ¶æ„ã€‚

---

## æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Node.js
- **æ¡†æ¶**: Express.js
- **è¯­è¨€**: TypeScript
- **ORM**: Prisma
- **æ•°æ®åº“**: 
  - MySQLï¼ˆè®¢å•ã€å·¥ç¨‹å•æ•°æ®ï¼‰
  - MongoDBï¼ˆå®¡è®¡æ—¥å¿—ï¼‰
- **æ–‡ä»¶ä¸Šä¼ **: Multer
- **æ•°æ®æ ¡éªŒ**: Zod

---

## æ•°æ®åº“ç»“æ„

### MySQL æ•°æ®åº“ï¼ˆè®¢å•/å·¥ç¨‹å•ï¼‰

#### Orderï¼ˆè®¢å•è¡¨ï¼‰
- `orderNumber`: è®¢å•å·ï¼ˆä¸»é”®ï¼‰
- `orderVer`: è®¢å•ç‰ˆæœ¬
- `orderUnique`: å”¯ä¸€ç´¢å¼•ï¼ˆç”¨äºæŸ¥è¯¢ï¼‰
- `status`: è®¢å•çŠ¶æ€ï¼ˆè‹±æ–‡æšä¸¾ï¼‰
- `customer`: å®¢æˆ·åç§°
- `sales`: ä¸šåŠ¡å‘˜
- `audit`: å®¡æ ¸å‘˜
- å…¶ä»–ä¸šåŠ¡å­—æ®µ...

#### EngineeringOrderï¼ˆå·¥ç¨‹å•è¡¨ï¼‰
- `workId`: å·¥ç¨‹å•å·ï¼ˆä¸»é”®ï¼‰
- `workVer`: ç‰ˆæœ¬å·
- `workUnique`: å”¯ä¸€ç´¢å¼•
- `reviewStatus`: å®¡æ ¸çŠ¶æ€ï¼ˆè‹±æ–‡æšä¸¾ï¼‰
- `workClerk`: åˆ¶å•å‘˜
- `workAudit`: å®¡æ ¸å‘˜
- å…¶ä»–ä¸šåŠ¡å­—æ®µ...

### MongoDB æ•°æ®åº“ï¼ˆå®¡è®¡æ—¥å¿—ï¼‰

#### AuditLogï¼ˆå®¡è®¡æ—¥å¿—è¡¨ï¼‰
- `action`: æ“ä½œåŠ¨ä½œ
- `actionDescription`: æ“ä½œæè¿°
- `userId`: ç”¨æˆ·ID
- `entityType`: å®ä½“ç±»å‹ï¼ˆOrder/WorkOrderï¼‰
- `entityId`: å®ä½“ID
- `orderNumber`: è®¢å•å·ï¼ˆå¯é€‰ï¼‰
- `time`: æ“ä½œæ—¶é—´

---

## DTOå±‚è½¬æ¢é€»è¾‘

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

**å‰åç«¯å­—æ®µåå’ŒçŠ¶æ€å€¼çš„åŒå‘è½¬æ¢**ï¼š
- **å‰ç«¯ä½¿ç”¨ä¸­æ–‡çŠ¶æ€**ï¼š`orderstatus: "è‰ç¨¿"`ã€`orderstatus: "å¾…å®¡æ ¸"`
- **åç«¯å­˜å‚¨è‹±æ–‡æšä¸¾**ï¼š`status: "DRAFT"`ã€`status: "PENDING_REVIEW"`
- **å­—æ®µåæ˜ å°„**ï¼šå‰ç«¯ `order_id` â†’ åç«¯ `orderNumber`ï¼Œå‰ç«¯ `chanPinMingXi` â†’ åç«¯ `orderItems`

### è½¬æ¢å‡½æ•°ä½ç½®

æ‰€æœ‰è½¬æ¢é€»è¾‘ç»Ÿä¸€åœ¨ `backend/src/dto/orderDTO.ts` å’Œ `backend/src/dto/workOrderDTO.ts` ä¸­ã€‚

#### è®¢å•çŠ¶æ€è½¬æ¢å‡½æ•°

```typescript
// å‰ç«¯ä¸­æ–‡ â†’ åç«¯è‹±æ–‡
export function orderStatusToDb(orderStatusText: string | undefined): string | undefined

// åç«¯è‹±æ–‡ â†’ å‰ç«¯ä¸­æ–‡
export function dbStatusToOrderStatus(dbStatus: string | undefined): string | undefined
```

#### è®¢å•DTOè½¬æ¢å‡½æ•°

```typescript
// åç«¯æ¨¡å‹ â†’ å‰ç«¯DTOï¼ˆæŸ¥è¯¢æ—¶ä½¿ç”¨ï¼‰
export function orderToDTO(order: any, auditLogs?: any[]): IOrderDTO

// å‰ç«¯DTO â†’ åç«¯æ¨¡å‹ï¼ˆåˆ›å»º/æ›´æ–°æ—¶ä½¿ç”¨ï¼Œå·²å‡†å¤‡ä½†æœªå®Œå…¨ä½¿ç”¨ï¼‰
export function dtoToOrder(dto: Partial<IOrderDTO>): any
```

### çŠ¶æ€æ˜ å°„è¡¨

è¯¦è§ [çŠ¶æ€æšä¸¾æ˜ å°„](#çŠ¶æ€æšä¸¾æ˜ å°„) ç« èŠ‚ã€‚

---

## APIæ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:3000/api`
- **Content-Type**: `application/json`ï¼ˆé™¤æ–‡ä»¶ä¸Šä¼ æ¥å£å¤–ï¼‰
- **æ–‡ä»¶ä¸Šä¼ **: `multipart/form-data`

### å¥åº·æ£€æŸ¥

#### GET `/api/health`
æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "ok",
  "timestamp": "2026-02-01T10:30:00.000Z"
}
```

---

### è®¢å•ç›¸å…³æ¥å£

#### 1. åˆ›å»º/æ›´æ–°è®¢å•

**POST** `/api/orders` æˆ– `/api/orders/create`

**è¯·æ±‚æ ¼å¼**: `multipart/form-data`

**è¯·æ±‚å‚æ•°**:
- `orderData` (string): JSONå­—ç¬¦ä¸²ï¼ŒåŒ…å«è®¢å•æ•°æ®
- `salesman` (string): ä¸šåŠ¡å‘˜å§“å
- `files` (File[]): é™„ä»¶æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
- `isDraft` (query): `true` è¡¨ç¤ºä¿å­˜è‰ç¨¿ï¼Œ`false` æˆ–çœç•¥è¡¨ç¤ºæäº¤å®¡æ ¸

**è¯·æ±‚ä½“ç¤ºä¾‹** (orderDataå­—æ®µå†…å®¹):
```json
{
  "order_id": "ORD-20260201-001",
  "order_ver": "V1",
  "order_unique": "ORD-20260201-001_V1",
  "customer": "åšæ–‡å‡ºç‰ˆç¤¾",
  "sales": "SALES-007-å°æ",
  "orderstatus": "è‰ç¨¿",
  "chanPinMingXi": [
    {
      "neiWen": "å†…æ–‡P1-P300",
      "houDu": 0.12,
      "keZhong": 128
    }
  ],
  "attachments": [
    {
      "category": "å®¢æˆ·åŸç¨¿",
      "fileName": "world_map_v1_print.pdf"
    }
  ]
}
```

**å“åº”**: è¿”å›åˆ›å»ºçš„è®¢å•å¯¹è±¡ï¼ˆåç«¯æ ¼å¼ï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µï¼‰

**çŠ¶æ€ç **:
- `200`: æˆåŠŸ
- `400`: æ ¡éªŒå¤±è´¥æˆ–å‚æ•°é”™è¯¯

**æ³¨æ„äº‹é¡¹**:
- å¦‚æœ `order_id` ä¸ºç©ºï¼Œåç«¯ä¼šè‡ªåŠ¨ç”Ÿæˆï¼š`AUTO-YYYYMMDDHHmmss-xxx`
- å¦‚æœè®¢å•å·²å­˜åœ¨ï¼ˆæ ¹æ® `orderNumber`ï¼‰ï¼Œåˆ™æ‰§è¡Œæ›´æ–°æ“ä½œ
- è‰ç¨¿æ¨¡å¼ï¼š`isDraft=true`ï¼ŒçŠ¶æ€è‡ªåŠ¨è®¾ä¸º `DRAFT`
- æäº¤æ¨¡å¼ï¼š`isDraft=false`ï¼ŒçŠ¶æ€è‡ªåŠ¨è®¾ä¸º `PENDING_REVIEW`

---

#### 2. æŸ¥è¯¢æ‰€æœ‰è®¢å•

**GET** `/api/orders/all`

**å“åº”**: è¿”å› `IOrderDTO[]` æ•°ç»„

**å“åº”ç¤ºä¾‹**:
```json
[
  {
    "order_id": "ORD-20260201-001",
    "order_ver": "V1",
    "order_unique": "ORD-20260201-001_V1",
    "customer": "åšæ–‡å‡ºç‰ˆç¤¾",
    "sales": "SALES-007-å°æ",
    "orderstatus": "è‰ç¨¿",
    "chanPinMingXi": [...],
    "auditLogs": [...],
    "attachments": [...]
  }
]
```

---

#### 3. æ ¹æ®ä¸šåŠ¡å‘˜æŸ¥è¯¢è®¢å•

**GET** `/api/orders/findBySales`

**æŸ¥è¯¢å‚æ•°**:
- `sales` (string, å¿…å¡«): ä¸šåŠ¡å‘˜å§“å

**ç¤ºä¾‹**: `/api/orders/findBySales?sales=å¼ ä¸‰`

**å“åº”**: è¿”å› `IOrderDTO[]` æ•°ç»„

---

#### 4. æ ¹æ®å®¡æ ¸å‘˜æŸ¥è¯¢è®¢å•

**GET** `/api/orders/findByAudit`

**æŸ¥è¯¢å‚æ•°**:
- `audit` (string, å¿…å¡«): å®¡æ ¸å‘˜å§“å

**ç¤ºä¾‹**: `/api/orders/findByAudit?audit=æå››`

**å“åº”**: è¿”å› `IOrderDTO[]` æ•°ç»„

---

#### 5. æ ¹æ®å”¯ä¸€ç´¢å¼•æŸ¥è¯¢è®¢å•

**GET** `/api/orders/findById`

**æŸ¥è¯¢å‚æ•°**:
- `order_id` (string, å¿…å¡«): è®¢å•çš„å”¯ä¸€ç´¢å¼•ï¼ˆ`order_unique`ï¼‰

**ç¤ºä¾‹**: `/api/orders/findById?order_id=ORD-20260201-001_V1`

**å“åº”**: è¿”å› `IOrderDTO` å¯¹è±¡ï¼Œå¦‚æœæœªæ‰¾åˆ°è¿”å› `404`

**æ›¿ä»£æ¥å£**: `/api/orders/unique/:uniqueId`ï¼ˆRESTfulé£æ ¼ï¼‰

---

#### 6. æŸ¥è¯¢å¾…å®¡æ ¸è®¢å•

**GET** `/api/orders/pending`

**å“åº”**: è¿”å›çŠ¶æ€ä¸º `PENDING_REVIEW` çš„æ‰€æœ‰è®¢å•ï¼ˆ`IOrderDTO[]`ï¼‰

---

#### 7. æ ¹æ®çŠ¶æ€æŸ¥è¯¢è®¢å•

**GET** `/api/orders/findPending`

**æŸ¥è¯¢å‚æ•°**:
- `orderstatus` (string, å¿…å¡«): ä¸­æ–‡çŠ¶æ€ï¼ˆå¦‚ `"å¾…å®¡æ ¸"`ã€`"è‰ç¨¿"`ï¼‰

**ç¤ºä¾‹**: `/api/orders/findPending?orderstatus=å¾…å®¡æ ¸`

**å“åº”**: è¿”å›æŒ‡å®šçŠ¶æ€çš„æ‰€æœ‰è®¢å•ï¼ˆ`IOrderDTO[]`ï¼‰

**æ”¯æŒçš„çŠ¶æ€å€¼**:
- `"è‰ç¨¿"`
- `"å¾…å®¡æ ¸"`
- `"å®¡æ ¸ä¸­"`
- `"é€šè¿‡"`
- `"é©³å›"`
- `"ç”Ÿäº§ä¸­"`
- `"å®Œæˆ"`
- `"å–æ¶ˆ"`

---

#### 8. æ›´æ–°è®¢å•çŠ¶æ€

**POST** `/api/orders/updateStatus`

**è¯·æ±‚ä½“**:
```json
{
  "order_unique": "ORD-20260201-001_V1",
  "orderstatus": "é€šè¿‡"
}
```

**å‚æ•°è¯´æ˜**:
- `order_unique` (string, å¿…å¡«): è®¢å•å”¯ä¸€ç´¢å¼•
- `orderstatus` (string, å¿…å¡«): ä¸­æ–‡çŠ¶æ€

**å“åº”**: è¿”å›æ›´æ–°åçš„è®¢å•å¯¹è±¡ï¼ˆ`IOrderDTO`ï¼‰

**çŠ¶æ€ç **:
- `200`: æˆåŠŸ
- `400`: å‚æ•°é”™è¯¯æˆ–çŠ¶æ€å€¼ä¸æ”¯æŒ

---

#### 9. æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•

**GET** `/api/orders/:id`

**è·¯å¾„å‚æ•°**:
- `id` (string): è®¢å•å·ï¼ˆ`orderNumber`ï¼‰

**ç¤ºä¾‹**: `/api/orders/ORD-20260201-001`

**å“åº”**: è¿”å› `IOrderDTO` å¯¹è±¡ï¼Œå¦‚æœæœªæ‰¾åˆ°è¿”å› `404`

---

### å·¥ç¨‹å•ç›¸å…³æ¥å£

#### 1. åˆ›å»º/æ›´æ–°å·¥ç¨‹å•

**POST** `/api/work-orders` æˆ– `/api/work-orders/create`

**è¯·æ±‚æ ¼å¼**: `multipart/form-data`

**è¯·æ±‚å‚æ•°**:
- `workOrderJson` (string): JSONå­—ç¬¦ä¸²ï¼ŒåŒ…å«å·¥ç¨‹å•æ•°æ®
- `files` (File[]): é™„ä»¶æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

**è¯·æ±‚ä½“ç¤ºä¾‹** (workOrderJsonå­—æ®µå†…å®¹):
```json
{
  "work_id": "ORD-20260201-001_W",
  "work_ver": "V1",
  "work_unique": "ORD-20260201-001_W_V1",
  "work_clerk": "CZ001-ç‹å°ç¾",
  "work_audit": "SH005-å¼ ç»ç†",
  "workorderstatus": "å¾…å®¡æ ¸",
  "intermedia": [
    {
      "buJianMingCheng": "ç›’èº«",
      "yinShuaYanSe": "5C+1C",
      "wuLiaoMingCheng": "157gé“œç‰ˆçº¸è£±2.0ç°æ¿"
    }
  ]
}
```

**å“åº”**: è¿”å›åˆ›å»ºçš„å·¥ç¨‹å•å¯¹è±¡

---

#### 2. æ ¹æ®åˆ¶å•å‘˜æŸ¥è¯¢å·¥ç¨‹å•

**GET** `/api/workOrders/findByClerk`

**æŸ¥è¯¢å‚æ•°**:
- `work_clerk` (string, å¿…å¡«): åˆ¶å•å‘˜å§“å
- å…¼å®¹å‚æ•°: `sales` (æ—§ç‰ˆ)

**ç¤ºä¾‹**: `/api/workOrders/findByClerk?work_clerk=ç‹å°ç¾`

**å“åº”**: è¿”å› `IWorkOrderDTO[]` æ•°ç»„

---

#### 3. æ ¹æ®å®¡æ ¸å‘˜æŸ¥è¯¢å·¥ç¨‹å•

**GET** `/api/workOrders/findByAudit`

**æŸ¥è¯¢å‚æ•°**:
- `work_audit` (string, å¿…å¡«): å®¡æ ¸å‘˜å§“å
- å…¼å®¹å‚æ•°: `audit` (æ—§ç‰ˆ)

**ç¤ºä¾‹**: `/api/workOrders/findByAudit?work_audit=å¼ ç»ç†`

**å“åº”**: è¿”å› `IWorkOrderDTO[]` æ•°ç»„

---

#### 4. æ ¹æ®å”¯ä¸€ç´¢å¼•æŸ¥è¯¢å·¥ç¨‹å•

**GET** `/api/workOrders/findById`

**æŸ¥è¯¢å‚æ•°**:
- `work_unique` (string, å¿…å¡«): å·¥ç¨‹å•çš„å”¯ä¸€ç´¢å¼•

**ç¤ºä¾‹**: `/api/workOrders/findById?work_unique=ORD-20260201-001_W_V1`

**å“åº”**: è¿”å› `IWorkOrderDTO` å¯¹è±¡ï¼Œå¦‚æœæœªæ‰¾åˆ°è¿”å› `404`

**æ›¿ä»£æ¥å£**: `/api/work-orders/unique/:uniqueId`ï¼ˆRESTfulé£æ ¼ï¼‰

---

#### 5. æŸ¥è¯¢å¾…å®¡æ ¸å·¥ç¨‹å•

**GET** `/api/workOrders/pending` æˆ– `/api/work-orders/pending`

**å“åº”**: è¿”å›çŠ¶æ€ä¸º `PENDING` çš„æ‰€æœ‰å·¥ç¨‹å•ï¼ˆ`IWorkOrderDTO[]`ï¼‰

---

#### 6. æ›´æ–°å·¥ç¨‹å•çŠ¶æ€

**POST** `/api/workOrders/updateStatus`

**è¯·æ±‚ä½“**:
```json
{
  "work_unique": "ORD-20260201-001_W_V1",
  "workorderstatus": "é€šè¿‡"
}
```

**å‚æ•°è¯´æ˜**:
- `work_unique` (string, å¿…å¡«): å·¥ç¨‹å•å”¯ä¸€ç´¢å¼•
- `workorderstatus` (string, å¿…å¡«): ä¸­æ–‡çŠ¶æ€

**å“åº”**: è¿”å›æ›´æ–°åçš„å·¥ç¨‹å•å¯¹è±¡

---

#### 7. æ›´æ–°å·¥åºè¿›åº¦

**POST** `/api/workOrders/updateProcess`

**è¯·æ±‚ä½“**:
```json
{
  "work_id": "ORD-20260201-001_W",
  "process": 0,
  "dangQianJinDu": "85%"
}
```

**å‚æ•°è¯´æ˜**:
- `work_id` (string, å¿…å¡«): å·¥ç¨‹å•å·
- `process` (number, å¿…å¡«): å·¥åºç´¢å¼•ï¼ˆ0, 1, 2...ï¼‰
- `dangQianJinDu` (string, å¯é€‰): å½“å‰è¿›åº¦æè¿°

**å“åº”**: è¿”å›æ›´æ–°åçš„å·¥ç¨‹å•å¯¹è±¡

---

#### 8. æ ¹æ®å·¥ç¨‹å•å·æŸ¥è¯¢å·¥ç¨‹å•

**GET** `/api/work-orders/:id`

**è·¯å¾„å‚æ•°**:
- `id` (string): å·¥ç¨‹å•å·ï¼ˆ`workId`ï¼‰

**ç¤ºä¾‹**: `/api/work-orders/ORD-20260201-001_W`

**å“åº”**: è¿”å› `IWorkOrderDTO` å¯¹è±¡ï¼Œå¦‚æœæœªæ‰¾åˆ°è¿”å› `404`

---

## çŠ¶æ€æšä¸¾æ˜ å°„

### è®¢å•çŠ¶æ€æ˜ å°„

| å‰ç«¯ä¸­æ–‡çŠ¶æ€ | åç«¯è‹±æ–‡æšä¸¾ | è¯´æ˜ |
|------------|------------|------|
| `è‰ç¨¿` | `DRAFT` | è®¢å•è‰ç¨¿çŠ¶æ€ |
| `å¾…å®¡æ ¸` | `PENDING_REVIEW` | ç­‰å¾…å®¡æ ¸ |
| `å®¡æ ¸ä¸­` | `IN_REVIEW` | æ­£åœ¨å®¡æ ¸ä¸­ |
| `é€šè¿‡` | `APPROVED` | å®¡æ ¸é€šè¿‡ |
| `é©³å›` | `REJECTED` | å®¡æ ¸é©³å› |
| `ç”Ÿäº§ä¸­` | `IN_PRODUCTION` | æ­£åœ¨ç”Ÿäº§ä¸­ |
| `å®Œæˆ` | `COMPLETED` | è®¢å•å®Œæˆ |
| `å–æ¶ˆ` | `CANCELLED` | è®¢å•å–æ¶ˆ |

### å·¥ç¨‹å•çŠ¶æ€æ˜ å°„

| å‰ç«¯ä¸­æ–‡çŠ¶æ€ | åç«¯è‹±æ–‡æšä¸¾ | è¯´æ˜ |
|------------|------------|------|
| `è‰ç¨¿` | `PENDING` | å·¥ç¨‹å•è‰ç¨¿ |
| `å¾…å®¡æ ¸` | `PENDING` | ç­‰å¾…å®¡æ ¸ |
| `é€šè¿‡` | `APPROVED` | å®¡æ ¸é€šè¿‡ |
| `é©³å›` | `REJECTED` | å®¡æ ¸é©³å› |
| `éœ€ä¿®æ”¹` | `NEEDS_REVISION` | éœ€è¦ä¿®æ”¹ |
| `ç”Ÿäº§ä¸­` | `APPROVED` | ç”Ÿäº§ä¸­ï¼ˆæ˜ å°„åˆ°APPROVEDï¼‰ |
| `å®Œæˆ` | `APPROVED` | å®Œæˆï¼ˆæ˜ å°„åˆ°APPROVEDï¼‰ |
| `å–æ¶ˆ` | `REJECTED` | å–æ¶ˆï¼ˆæ˜ å°„åˆ°REJECTEDï¼‰ |

**æ³¨æ„**: å·¥ç¨‹å•çš„çŠ¶æ€æ˜ å°„ä¸è®¢å•ç•¥æœ‰ä¸åŒï¼Œéƒ¨åˆ†ä¸šåŠ¡çŠ¶æ€ä¼šæ˜ å°„åˆ°å®¡æ ¸ç»“æœæšä¸¾ã€‚

---

## é”™è¯¯å¤„ç†

### æ ‡å‡†é”™è¯¯å“åº”æ ¼å¼

```json
{
  "error": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

### å¸¸è§é”™è¯¯ç 

- `400`: è¯·æ±‚å‚æ•°é”™è¯¯ã€æ ¡éªŒå¤±è´¥ã€çŠ¶æ€å€¼ä¸æ”¯æŒ
- `404`: èµ„æºæœªæ‰¾åˆ°ï¼ˆè®¢å•/å·¥ç¨‹å•ä¸å­˜åœ¨ï¼‰
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### é”™è¯¯å¤„ç†ç¤ºä¾‹

**å‚æ•°ç¼ºå¤±**:
```json
{
  "error": "Missing sales parameter"
}
```

**æ ¡éªŒå¤±è´¥**:
```json
{
  "error": "æ ¡éªŒå¤±è´¥: customer: å®¢æˆ·åç§°ä¸ºå¿…å¡«é¡¹"
}
```

**çŠ¶æ€å€¼ä¸æ”¯æŒ**:
```json
{
  "error": "Unsupported order status: æœªçŸ¥çŠ¶æ€"
}
```

---

## æ³¨æ„äº‹é¡¹

### 1. å­—æ®µåæ˜ å°„

å‰ç«¯å’Œåç«¯çš„å­—æ®µåå­˜åœ¨å·®å¼‚ï¼ŒDTOå±‚ä¼šè‡ªåŠ¨å¤„ç†ï¼š

| å‰ç«¯å­—æ®µå | åç«¯å­—æ®µå | è¯´æ˜ |
|----------|----------|------|
| `order_id` | `orderNumber` | è®¢å•å· |
| `order_ver` | `orderVer` | è®¢å•ç‰ˆæœ¬ |
| `order_unique` | `orderUnique` | å”¯ä¸€ç´¢å¼• |
| `chanPinMingXi` | `orderItems` | äº§å“æ˜ç»† |
| `orderstatus` | `status` | è®¢å•çŠ¶æ€ï¼ˆä¸­æ–‡â†’è‹±æ–‡ï¼‰ |

### 2. çŠ¶æ€å€¼ä½¿ç”¨

- **å‰ç«¯å‘é€**: å§‹ç»ˆä½¿ç”¨ä¸­æ–‡çŠ¶æ€ï¼ˆå¦‚ `"è‰ç¨¿"`ã€`"å¾…å®¡æ ¸"`ï¼‰
- **åç«¯è¿”å›**: DTOå±‚ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºä¸­æ–‡çŠ¶æ€
- **åç«¯å­˜å‚¨**: æ•°æ®åº“å­˜å‚¨è‹±æ–‡æšä¸¾

### 3. æ—¥æœŸæ ¼å¼

- **å‰ç«¯å‘é€**: `yyyy-mm-dd` æ ¼å¼å­—ç¬¦ä¸²ï¼ˆå¦‚ `"2026-02-01"`ï¼‰
- **åç«¯è¿”å›**: `yyyy-mm-dd` æ ¼å¼å­—ç¬¦ä¸²
- **åç«¯å­˜å‚¨**: Date ç±»å‹

### 4. æ–‡ä»¶ä¸Šä¼ 

- ä½¿ç”¨ `multipart/form-data` æ ¼å¼
- æ–‡ä»¶å­—æ®µå: `files`ï¼ˆæ•°ç»„ï¼‰
- æ–‡ä»¶å­˜å‚¨åœ¨ `backend/uploads/` ç›®å½•
- æ–‡ä»¶URLæ ¼å¼: `/uploads/{filename}`

### 5. è®¢å•å·ç”Ÿæˆè§„åˆ™

- å¦‚æœå‰ç«¯æœªæä¾› `order_id`ï¼Œåç«¯è‡ªåŠ¨ç”Ÿæˆï¼š`AUTO-YYYYMMDDHHmmss-xxx`
- æ ¼å¼: `AUTO-` + 14ä½æ—¶é—´æˆ³ + `-` + 3ä½éšæœºæ•°

### 6. å·¥ç¨‹å•å·ç”Ÿæˆè§„åˆ™

- å¦‚æœå‰ç«¯æœªæä¾› `work_id`ï¼Œåç«¯è‡ªåŠ¨ç”Ÿæˆï¼š`WORK-YYYYMMDDHHmmss-xxx`
- æ ¼å¼: `WORK-` + 14ä½æ—¶é—´æˆ³ + `-` + 3ä½éšæœºæ•°

### 7. å®¡è®¡æ—¥å¿—

- åˆ›å»º/æ›´æ–°è®¢å•/å·¥ç¨‹å•æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨MongoDBä¸­è®°å½•å®¡è®¡æ—¥å¿—
- å®¡è®¡æ—¥å¿—åŒ…å«ï¼šæ“ä½œåŠ¨ä½œã€æ“ä½œæè¿°ã€ç”¨æˆ·IDã€å®ä½“ç±»å‹ã€å®ä½“IDã€æ—¶é—´æˆ³

### 8. æ•°æ®æ ¡éªŒ

- ä½¿ç”¨ Zod Schema è¿›è¡Œæ•°æ®æ ¡éªŒ
- è‰ç¨¿æ¨¡å¼ï¼ˆ`isDraft=true`ï¼‰: å…è®¸æ‰€æœ‰å­—æ®µä¸ºç©º
- æäº¤æ¨¡å¼ï¼ˆ`isDraft=false`ï¼‰: è‡³å°‘éœ€è¦ `customer` å­—æ®µ

### 9. æ•°æ®åº“äº‹åŠ¡

- æ›´æ–°è®¢å•æ—¶ä¼šä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- æ›´æ–°è®¢å•æ˜ç»†æ—¶ä¼šå…ˆåˆ é™¤æ—§æ•°æ®ï¼Œå†åˆ›å»ºæ–°æ•°æ®

### 10. å…¼å®¹æ€§

- éƒ¨åˆ†æ¥å£æ”¯æŒæ—§ç‰ˆå‚æ•°åï¼ˆå¦‚ `sales` å…¼å®¹ `work_clerk`ï¼‰
- å»ºè®®ä½¿ç”¨æ–°ç‰ˆå‚æ•°åï¼Œæ—§ç‰ˆå‚æ•°å¯èƒ½åœ¨åç»­ç‰ˆæœ¬ä¸­ç§»é™¤

---

## å¼€å‘å»ºè®®

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```typescript
// åˆ›å»ºè®¢å•ï¼ˆè‰ç¨¿ï¼‰
const formData = new FormData();
formData.append('orderData', JSON.stringify({
  customer: 'åšæ–‡å‡ºç‰ˆç¤¾',
  sales: 'SALES-007-å°æ',
  orderstatus: 'è‰ç¨¿',
  // ... å…¶ä»–å­—æ®µ
}));
formData.append('salesman', 'SALES-007-å°æ');
formData.append('files', file1);
formData.append('files', file2);

const response = await fetch('http://localhost:3000/api/orders/create?isDraft=true', {
  method: 'POST',
  body: formData
});

// æŸ¥è¯¢è®¢å•
const orders = await fetch('http://localhost:3000/api/orders/findBySales?sales=å¼ ä¸‰')
  .then(res => res.json());

// æ›´æ–°è®¢å•çŠ¶æ€
await fetch('http://localhost:3000/api/orders/updateStatus', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    order_unique: 'ORD-20260201-001_V1',
    orderstatus: 'é€šè¿‡'
  })
});
```

### æµ‹è¯•å»ºè®®

1. ä½¿ç”¨ Postman æˆ–ç±»ä¼¼å·¥å…·æµ‹è¯•æ‰€æœ‰æ¥å£
2. æµ‹è¯•æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
3. æµ‹è¯•çŠ¶æ€è½¬æ¢æ˜¯å¦æ­£ç¡®
4. æµ‹è¯•é”™è¯¯å¤„ç†
5. æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼ˆç©ºå€¼ã€ç‰¹æ®Šå­—ç¬¦ç­‰ï¼‰

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- ä»£ç ä»“åº“: https://github.com/xxxhhhyxy/E_Print
- DTOå±‚ä»£ç : `backend/src/dto/orderDTO.ts`ã€`backend/src/dto/workOrderDTO.ts`
- Serviceå±‚ä»£ç : `backend/src/orderService.ts`ã€`backend/src/workOrderService.ts`
- è·¯ç”±å®šä¹‰: `backend/src/index.ts`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-02-01  
**ç»´æŠ¤è€…**: åç«¯å¼€å‘å›¢é˜Ÿ
